<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>How I got 3.1.2 on a 3G[s] from 2011 / Keaton Burleson</title>
  <meta name="description" content="">
  <meta property="og:title" content="Keaton's Page" />
  
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/2017/04/12/how-i-got-312-on-a-3gs-from-2011.html">
  <link rel="alternate" type="application/rss+xml" title="Keaton Burleson" href="/feed.xml">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/apple_icon.png">
  
  <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
  <script type="text/javascript" src="/assets/js/main-bundle.js" charset="utf-8"></script>

</head>
 
<table class="header-container">
    <tr>
        <td>
            <a href="/">Home</a>
            <a href="/blog/">Blog</a>
            <a href="/#me">About</a>
        </td>
        <td>
            <h1>Keaton Burleson</h1>
        </td>
    </tr>
</table>



<body id="post">
    <div class="wrapper" id="white post">
            <article class="post post--full">
                <div class="post-head">
                    <h2 class="post-title">How I got 3.1.2 on a 3G[s] from 2011</h2> 
                    <h3 class="post-date">April 12 2017</h3>
                </div>
                
                <div class="post-content">
                    <p><img src="https://images.128keaton.com/iphone3gs3.1.2.jpg#stylized" alt="" /></p>

<p>See that? That is an iPhone 3G[s] running 3.1.2. What makes this special is that this is a <em>new boot ROM</em> 3G[s] thats been downgraded. And, for the cherry on top, its an iPhone that shipped with iOS 5 originally. How did I do it?</p>

<p>Just recently, a <a href="https://twitter.com/axi0mX">person</a> on Twitter called ‚Äòaxi0mX‚Äô released the <a href="https://github.com/axi0mX/alloc8">alloc8</a> boot ROM exploit affecting the new and old boot ROM 3G[s], though he recommends that the 24k exploit still be used on old boot ROM devices due to a <a href="https://github.com/axi0mX/ipwndfu/blob/master/JAILBREAK-GUIDE.md#3-second-delays-when-using-a-phone-jailbroken-with-alloc8">slow down</a> that the alloc8 exploit introduces. Thankfully, this exploit is relatively easy to use, if you have the right tools</p>

<h2 id="tools">Tools:</h2>
<ul>
  <li>Xcode Command Line tools (<code class="highlighter-rouge">xcode-select --install</code>)</li>
  <li><a href="https://brew.sh/">Homebrew</a></li>
  <li><strong>(updated 4-20-2017)</strong> A Mac running Mavericks or newer<sup><a href="#1">1</a></sup></li>
</ul>

<h2 id="step-1">Step 1:</h2>

<p><strong>(updated 4-12-2017)</strong>
Time to install all the dependancies.
Open Terminal, then install pip/Python from Homebrew like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>python <span class="nt">--with-brewed-openssl</span>
</code></pre></div></div>

<p>Next, install libusb, similar to how you installed Python, using Homebrew:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>libusb
</code></pre></div></div>

<p>Quit Terminal and then reopen Terminal.</p>

<p>Lastly, run this last command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pyusb
</code></pre></div></div>

<h2 id="step-2">Step 2:</h2>

<p>Navigate to a nice and safe directory in Terminal, e.g. <code class="highlighter-rouge">cd ~/Desktop</code>. There, clone the ipwndfu repository:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/axi0mX/ipwndfu <span class="o">&amp;&amp;</span> <span class="nb">cd </span>ipwndfu
</code></pre></div></div>

<h2 id="step-3">Step 3:</h2>

<p>Thanks to some oddities in libusb for El Capitan and Sierra, it is necessary to patch the binary we use. <strong>Only do this on El Capitan and Sierra</strong>. Thankfully, axi0mX has made it pretty easy for us.
Verify that the version installed on your computer is the same one the patch is made for (1.0.21) by running this command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl sha1 /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib
</code></pre></div></div>

<p>If the little string of numbers and letters (the hash) matches <code class="highlighter-rouge">02da61201c8f67b723bca5fb44b35797d1021625</code> then you should be fine.</p>

<p>Now, its time to patch. inside the ipwndfu directory, run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>bspatch /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib libusb-patches/libusb-1.0.21-02da61201c8f67b723bca5fb44b35797d1021625.patch
</code></pre></div></div>

<p>Now, just to make sure that the patch was applied successfully, rerun this command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl sha1 /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib
</code></pre></div></div>

<p>The hash should be: <code class="highlighter-rouge">f356ee6052cd520b46ca50333b937ff2efe4477b</code></p>

<p>All good?</p>

<h2 id="step-4">Step 4:</h2>

<p>Now, it is time to generate a custom IPSW for your 3G[s]. Below is a table which breaks down the versions and tools to accomplish this.</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Tool</th>
      <th>Success</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>iOS 3.1</td>
      <td><a href="https://github.com/axi0mX/PwnageTool-mirror/raw/master/PwnageTool_3.1.3.dmg">PwnageTool 3.1.3</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 3.1.2/3</td>
      <td><a href="https://github.com/axi0mX/PwnageTool-mirror/raw/master/PwnageTool_3.1.5.dmg">PwnageTool 3.1.5</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 4.0</td>
      <td><a href="https://github.com/axi0mX/PwnageTool-mirror/raw/master/PwnageTool_4.01.dmg">PwnageTool 4.01</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 4.3.3</td>
      <td><a href="http://www.iphonehacks.com/download-redsn0w">redsn0w 0.9.15 beta 3</a></td>
      <td>üò´</td>
    </tr>
    <tr>
      <td>iOS 5.0</td>
      <td><a href="http://www.iphonehacks.com/download-redsn0w">redsn0w 0.9.15 beta 3</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 5.0.1</td>
      <td><a href="http://www.iphonehacks.com/download-redsn0w">redsn0w 0.9.15 beta 3</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 5.1</td>
      <td><a href="http://www.iphonehacks.com/download-redsn0w">redsn0w 0.9.15 beta 3</a></td>
      <td>üòÄ</td>
    </tr>
    <tr>
      <td>iOS 5.1.1</td>
      <td><a href="http://www.iphonehacks.com/download-redsn0w">redsn0w 0.9.15 beta 3</a></td>
      <td>üòÄ</td>
    </tr>
  </tbody>
</table>

<p><em>Notes on using redsn0w:</em></p>

<p>During the process, redsn0w will ask you something along the lines of ‚ÄòWill this custom IPSW be used on a newer (fixed) version of the iPhone3GS?‚Äô. You must answer ‚Äòno‚Äô to create an IPSW laced with the 24Kpwn exploit, which is essential for alloc8.</p>

<p>All the tools above will walk you through the IPSW creation, just don‚Äôt stray too far from the default options and you should be fine. I opted for 3.1.2, but thats my personal choice. I also downloaded my firmware file from <a href="https://ipsw.me">ipsw.me</a>. Also, since we‚Äôre on the topic of downloading firmwares, you also need to download the 4.3.5 IPSW for your 3G[s] <strong>and place it in your ipwndfu folder</strong></p>

<p>From there (again in your ipwndfu folder) run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip <span class="nt">-p</span> iPhone2,1_4.3.5_8L1_Restore.ipsw Firmware/dfu/iBSS.n88ap.RELEASE.dfu <span class="o">&gt;</span> n88ap-iBSS-4.3.5.img3
</code></pre></div></div>

<p>You should be all set to run ipwndfu here pretty soon.</p>

<h2 id="step-5">Step 5:</h2>

<p><strong>Note: if you installed all the pip dependancies with the Homebrew version, you must prepend <code class="highlighter-rouge">python</code> to the commands like I have done below</strong></p>

<p>Okay, here is where it got dodgy for me. The developer recommends you either use a computer with iTunes 11.1 or older, or use <code class="highlighter-rouge">idevicerestore</code> to restore the custom firmware file to your 3G[s]. I tried getting idevicerestore to work, I compiled all what I needed, but it kept getting stuck. I gave up and just grabbed my trusty 17‚Äù PowerBook running 10.5.8 with iTunes 10. It took me twice to get it to work, but I‚Äôm writing this from the perspective of me restoring it with iTunes.</p>

<p>I went ahead and transferred the custom IPSW to the machine, ready for restore. I had iTunes opened, raring to go.</p>

<p>Now, plug the iPhone into the machine with the ipwndfu tools. Put the iPhone into DFU mode, which goes as follows:</p>

<ol>
  <li>Turn the phone off.</li>
  <li>Hold the power button for <strong>3</strong> seconds.</li>
  <li>Hold the home and power button for <strong>10</strong> seconds.</li>
  <li>Release the power button, but continue to hold the home button without releasing for <strong>15</strong> more seconds.</li>
</ol>

<p>Now, iTunes should popup complaining about a device in recovery.</p>

<p>Go back to Terminal, and inside of the ipwndfu tools directory, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ./ipwndfu <span class="nt">-p</span>
</code></pre></div></div>

<p>It should output something like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Yerba-Buena:ipwndfu keatonburleson<span class="nv">$ </span>python ./ipwndfu <span class="nt">-p</span>
<span class="k">***</span> based on limera1n exploit <span class="o">(</span>heap overflow<span class="o">)</span> by geohot <span class="k">***</span>
Found: CPID:8920 CPRV:15 CPFM:03 SCEP:03 BDID:00 ECID:XXXXXXXXXXXXXXXX SRTG:[iBoot-359.3.2]
Device is now <span class="k">in </span>pwned DFU Mode.
</code></pre></div></div>

<p>Great!</p>

<p>Unplug the device, and quickly move it to the machine with iTunes &lt;11.1, in my case, my PowerBook. iTunes should once again popup about a device in recovery. Now we‚Äôre rolling. Okay, deep breath. I‚Äôm assuming your iPhone is backed up if you care. Now we need to browse to our custom firmware. Hold down Shift (for Windows) or Alt/option (for Mac) and a file dialog should come up. Browse and select our custom firmware. The restoration process should begin. I had to do this process twice, not sure why, but when I finished, it showed no errors.</p>

<h2 id="step-6">Step 6:</h2>

<p>After your restore is complete, you should be at a black screen. Move the phone to the machine with the tools once again. Next, we‚Äôre running the same command as earlier to get it into a pwned DFU state:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ./ipwndfu <span class="nt">-p</span>
</code></pre></div></div>

<p>It should output something like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Yerba-Buena:ipwndfu keatonburleson<span class="nv">$ </span>python ./ipwndfu <span class="nt">-p</span>
<span class="k">***</span> based on limera1n exploit <span class="o">(</span>heap overflow<span class="o">)</span> by geohot <span class="k">***</span>
Found: CPID:8920 CPRV:15 CPFM:03 SCEP:03 BDID:00 ECID:XXXXXXXXXXXXXXXX SRTG:[iBoot-359.3.2]
Device is now <span class="k">in </span>pwned DFU Mode.
</code></pre></div></div>

<p>Now, run this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ./ipwndfu <span class="nt">-x</span>
</code></pre></div></div>

<p>Which, in turn, should provide an output like this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Yerba-Buena:ipwndfu keatonburleson<span class="nv">$ </span>python ./ipwndfu <span class="nt">-x</span>
Installing alloc8 exploit to NOR.
Dumping NOR, part 1/8.
Dumping NOR, part 2/8.
Dumping NOR, part 3/8.
Dumping NOR, part 4/8.
Dumping NOR, part 5/8.
Dumping NOR, part 6/8.
Dumping NOR, part 7/8.
Dumping NOR, part 8/8.
NOR backed up to file: nor-backups/nor-xxxxxxxxx-20170411-193959.dump
Sending iBSS.
Waiting <span class="k">for </span>iBSS to enter Recovery Mode.
Sending iBSS payload to flash NOR.
Sending run command.
If screen is not red, NOR was flashed successfully and device will reboot.
</code></pre></div></div>
<p>The whole process should take about 10 seconds, and your screen on your iPhone should be green for a considerable amount of that time.</p>

<p>Thankfully, the developer provided some nice troubleshooting tips:</p>

<ul>
  <li>
    <p>If there are any errors before the screen turned green, it is safe to try again.</p>
  </li>
  <li>
    <p>If the screen turns red, something went wrong while your phone was being flashed. Trying again probably won‚Äôt help.</p>
  </li>
</ul>

<p>Hopefully your phone should be booting whatever iOS you chose! Comment below if something bad happens or you discover another way to restore!</p>

<p>If you are having issues running this command, check out <a href="#troubleshooting">Troubleshooting</a> below.</p>

<h2 id="troubleshooting">Troubleshooting</h2>
<p>(added 4-12-2017)</p>

<p>I had some friends try running the guide themselves, and they ran into some issues not covered.</p>

<h3 id="operation-timed-out">Operation timed out</h3>
<p><img src="https://images.128keaton.com/uhoh.jpg#stylized" alt="" />.</p>

<p>My friend on Slack ran into this. Not sure if it is an environment issue, as I did not have Python installed via Homebrew. I just had OS X‚Äôs default install. If you‚Äôre wondering if you are using Homebrew Python, run this command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which python
</code></pre></div></div>

<p>I added this to the guide, but I think it has something to do with the lack of OpenSSL in the default Python package. Running this in Terminal should fix that:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew update
brew <span class="nb">rm </span>python
brew <span class="nb">install </span>python <span class="nt">--with-brewed-openssl</span>
</code></pre></div></div>

<p>Thanks to <a href="https://github.com/Homebrew/legacy-homebrew/issues/14497">this</a> GitHub issue.</p>

<p>However, if you don‚Äôt want to really mess with Homebrew, or the proposed fix doesn‚Äôt work for you, here is another way.</p>

<p>First, remove the Homebrew Python install.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">rm </span>python
</code></pre></div></div>
<p>Then, close Terminal and reopen.</p>

<p>In Terminal, navigate somewhere safe, like <code class="highlighter-rouge">cd ~/Desktop</code>, and run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-O</span> https://bootstrap.pypa.io/get-pip.py
</code></pre></div></div>

<p>Next, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>python get-pip.py
</code></pre></div></div>
<p>Make sure you‚Äôve installed libusb, and then install pyusb like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pyusb
</code></pre></div></div>

<p>Hopefully that should get you running again.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>I‚Äôd like to give a major thanks to the developer for writing really good documentation in the first place, and another thanks for <em>creating</em> this awesome open source jailbreak and boot ROM exploit for a device almost 9 years old.</p>

<p><span id="1" class="small"><sup>1</sup> there is a bug that the author hasn‚Äôt made progress fixing in versions older than OS X 10.9</span></p>
 
                </div>
                

<section class="comments">
	<div class="constrain--body">
		<div class="comments__existing js-comments">
			
				

				

					
					
					
					
					

					<article id="comment1" class="js-comment comment">

	<div class="comment__content-wrapper">
		<h3 class="comment-meta">
			<span id="name">Marc Hilberer</span>
			
				<span id="date">
				Wednesday, April 12th, 2017, 05.56pm
				</span>
			
		</h3>
		<div class="comment__body">
			<p>What about Windows?</p>

		</div>
	</div>
</article>

				

					
					
					
					
					

					<article id="comment2" class="js-comment comment">

	<div class="comment__content-wrapper">
		<h3 class="comment-meta">
			<span id="name">Keaton Burleson</span>
			
				<span id="date">
				Wednesday, April 19th, 2017, 12.12am
				</span>
			
		</h3>
		<div class="comment__body">
			<p>Marc, Windows isn‚Äôt supported at this time.</p>

<p>It is possible, but the developer hasn‚Äôt moved to create anything for Windows users.</p>

		</div>
	</div>
</article>

				

					
					
					
					
					

					<article id="comment3" class="js-comment comment">

	<div class="comment__content-wrapper">
		<h3 class="comment-meta">
			<span id="name">John K.</span>
			
				<span id="date">
				Sunday, August 20th, 2017, 03.59am
				</span>
			
		</h3>
		<div class="comment__body">
			<p>I am stuck on patching the USB at Step 3:<br />
sudo bspatch /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib /usr/local/Cellar/libusb/1.0.21/lib/libusb-1.0.0.dylib libusb-patches/libusb-1.0.21-02da61201c8f67b723bca5fb44b35797d1021625.patch</p>

<p>It returned:bspatch: fopen(libusb-patches/libusb-1.0.21-02da61201c8f67b723bca5fb44b35797d1021625.patch): No such file or directory</p>

<p>Please advise.</p>

		</div>
	</div>
</article>

				

					
					
					
					
					

					<article id="comment4" class="js-comment comment">

	<div class="comment__content-wrapper">
		<h3 class="comment-meta">
			<span id="name">Keaton Burleson</span>
			
				<span id="date">
				Sunday, August 20th, 2017, 06.58pm
				</span>
			
		</h3>
		<div class="comment__body">
			<p>John, I need to update this guide, but it appears the patches aren‚Äôt necessary anymore. They were removed in this commit: https://github.com/axi0mX/ipwndfu/commit/220b8f307debe39099fded4e3ce979d3b1620e0d, I will test when I get a chance. Thanks.</p>

		</div>
	</div>
</article>

				
			
		</div>
		<form id="post-new-comment" class="form" action="https://api.staticman.net/v2/entry/128keaton/128keaton.com/pre-publish/comments" method="post">
    <input type="hidden" name="options[slug]" value="2017-04-12-how-i-got-3-1-2-on-a-3g-s-from-2011">
    <input type="hidden" name="options[parent]" value="2017-04-12-how-i-got-3-1-2-on-a-3g-s-from-2011">
    <input type="hidden" name="options[origin]" value="http://128keaton.com/2017/04/12/how-i-got-312-on-a-3gs-from-2011.html">
    <input type="hidden" name="options[reCaptcha][siteKey]" value="6LeQyhIUAAAAAFkUhONibgvEQffDC_5zH8hHzNHM">
    <input type="hidden" name="options[reCaptcha][secret]" value="6LeQyhIUAAAAAJYq-l1HrJhtxh_bvM1v-gEeOx0k">

    <input name="options[redirect]" type="hidden" value="http://128keaton.com/2017/04/12/how-i-got-312-on-a-3gs-from-2011.html">

    <input type="text" name="company" class="text-field" style="display: none">
    <input class="form__field text-field" type="text" name="fields[name]" placeholder="Name" required/>
    <input class="form__field text-field" type="email" name="fields[email]" placeholder="Email address (will not be public)" required/>
    <input class="form__field text-field" type="url" name="fields[url]" placeholder="Website (optional)" />
    <input class="form__field text-field" type="address" name="fields[address]" placeholder="Address (do not fill!)" style="display: none" />
    <textarea class="form__field text-field" rows="10" name="fields[message]" placeholder="Comment. Markdown is accepted." required></textarea>

    <div class="g-recaptcha" data-sitekey="6LeQyhIUAAAAAFkUhONibgvEQffDC_5zH8hHzNHM"></div>
    <script src='https://www.google.com/recaptcha/api.js'></script>

    <input class="cta" type="submit" value="Post comment" />
</form>

	</div>
</section>

            </article>
        <footer class="footer" id="post-footer">
	<h1>Read more:</h1>
	<table class="colophon">
		<tr>
		
		<td class="footer-post">
			<a href="/2018/08/10/moving-forward-with-macos-imaging.html">
				<h1>macOS Imaging and Testing</h1>
			</a>
		</td>
		
		<td class="footer-post">
			<a href="/2017/09/08/yahoo-widgets-2017.html">
				<h1>Yahoo! Widgets in 2017</h1>
			</a>
		</td>
		
		<td class="footer-post">
			<a href="/2017/04/12/how-i-got-312-on-a-3gs-from-2011.html">
				<h1>How I got 3.1.2 on a 3G[s] from 2011</h1>
			</a>
		</td>
		
	</tr>
	</table>
	&copy Keaton Burleson
</footer>

    </div>
</body>

</html>
